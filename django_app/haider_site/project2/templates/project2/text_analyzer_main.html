{% extends "app1/base.html" %}

{% load static %}
{% static "csv_files/data2.csv" %}

{% block children %}
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@100&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
<link rel="stylesheet" href="{% static 'app1/jquery-ui-1.12.1.custom/jquery-ui.css' %}">
<script
    src="https://code.jquery.com/jquery-3.5.1.js"
    integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
    crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>


<script src="{% static 'app1/jquery-ui-1.12.1.custom/jquery-ui.js' %}"></script>

<div class="loading-spinner"></div>



<div class='txa txa-outer-wrap'>

  <div class="txa-twin-wrapper switches-display">


    <div class="txa-textarea-wrap">
      <form id="u_form" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{u_form.text_value}}
        
        <label for="txa_textarea"></label>
        <textarea class="txa_textarea" id="txa_textarea" ></textarea>
        <button class='hidden-submit-btn' 
                              id="analyze_text_submit" 
                              type="submit">G</button>
      </form>

      <div>
        <button class="blue-button-rev" onclick="analyzeText(this)">ANALYZE TEXT</button>
      </div>
    </div>

    <div class="txa-side-panel">
      <div class="txa-side-panel-content">
        <div class="txa-side-panel-title">Results:</div>
        <div class="txa-results-container">
          <div><p>Word count</p></div>
          <div>
            <p>Frequency</p>
            <div id="my_dataviz"></div>
          </div>
          <div><p>Likely Topic</p></div>
          <div><p>Complexity?</p></div>
          <div>
            <p>Word Cloud</p>
            <img id="cloud_graph" src='{% get_media_prefix %}word_cloud.png'>

          </div>

        </div>
      </div>
    </div>

  </div>

</div>



<script>
  $('#cloud_graph').removeClass('visible');
  
  



function analyzeText(this_btn) {
    let text = $('#txa_textarea').val();
    $('#id_text_value').val(text);
    $('#analyze_text_submit').click();  // that will submit your form
  }



</script>

<script>

$('#u_form').submit(function (e) {
  // preventing from page reload and default actions
  e.preventDefault();
  let submitted_form = $(this);
  // serialize the data for sending the form data.
  var serializedData = $(this).serialize();

  $('.loading-spinner').show();
  // make POST ajax call
  $.ajax({
        type: 'POST',
        url: "{% url 'project2:analyze_text' %}",
        data: serializedData,
        success: function (response) {
            
            // Response here can Contain the stringified changed data when
            // you implement the change datatype POST
              
            // 1. clear the form.
            //submitted_form.trigger('reset');

            console.log('\n response on analyze_text', response)
            console.log(response['text_value'])

            // SUCCESS FEEDBACK
            let word_cloud_url = response['word_cloud_url'];

            // ->  Manipulate DOM to show data
            let prev_src = "{% get_media_prefix %}" + word_cloud_url;
            imageObject = document.getElementById("cloud_graph");
            // imageObject.style.display = 'inline-block';
            imageObject.src = prev_src;
            
            
            $('#cloud_graph').addClass('visible');
            
          
            $('.loading-spinner').hide();

            
            // -> trigger the GET Request here if needed            
              
          },
          error: function (response) {
              // alert the error if any error occured

              console.log('>> error occured in analyze_text! :\n', response);
              
          }
      });
  });

</script>

<script>
    $(window).on ('load', function() {
      $('.loading-spinner').hide();
      $('.table-outer-wrap').css('opacity', '1');
    });
  
    $('document').ready(function() {
      $('.loading-spinner').hide();
     
    });
  
   
  </script>

  
  
  
  <script src="{% static 'app1/project2_javascript.js' %}"></script>
  
  
  {% endblock children %}